<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>äº‘å¡é«˜çº§ç›²ç›’ CLOUDPASS PREMIUM BOX</title>
  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: relative;
      font-family: Arial, sans-serif;
      text-align: center;
      color: #fff;
      background: linear-gradient(to bottom, #ff7b00, #000000); /* æ©™é»‘æ¸å˜ï¼Œ100%è¦†ç›– */
    }
    h1 {
      margin-top: 30px;
      font-size: 30px;
      position: relative;
      z-index: 1;
    }
    .form-container {
      margin: 20px;
      position: relative;
      z-index: 1;
    }
    input, button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }
    #startButton {
      background-color: #ff8800;
      color: white;
      cursor: pointer;
    }
    #startButton:disabled {
      background-color: gray;
      cursor: not-allowed;
    }
    .blindbox {
      width: 200px;
      margin: 20px auto;
      transition: transform 0.3s;
      position: relative;
      z-index: 1;
    }
    .shake {
      animation: shake 1s;
    }
    @keyframes shake {
      0% { transform: rotate(0deg);}
      25% { transform: rotate(10deg);}
      50% { transform: rotate(-10deg);}
      75% { transform: rotate(10deg);}
      100% { transform: rotate(0deg);}
    }
    .result {
      margin: 20px;
      text-align: left;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      position: relative;
      z-index: 1;
    }
    #adminZone {
      display: none;
      margin-top: 30px;
      position: relative;
      z-index: 1;
    }
    #adminZone button {
      background-color: #ff4444;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .admin-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ff8800;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h1>äº‘å¡é«˜çº§ç›²ç›’ / CLOUDPASS PREMIUM BOX</h1>

<div class="form-container">
  <input type="text" id="zmycode" placeholder="è¯·è¾“å…¥ZMYç¼–å· / Enter ZMY Code">
  <input type="email" id="email" placeholder="è¯·è¾“å…¥Email / Enter Email">
  <input type="number" id="drawtimes" placeholder="æŠ½å¥–æ¬¡æ•° / Draw Times" min="1">
  <br>
  <button id="startButton">å¼€å§‹æŠ½å¥– / Start Draw</button>
</div>

<img src="blindbox.png" alt="ç›²ç›’" id="blindbox" class="blindbox">

<div id="result" class="result"></div>

<!-- ç®¡ç†å‘˜åŒºåŸŸ -->
<div id="adminZone">
  <button onclick="resetPool()">é‡ç½®å¥–æ±  / Reset Prize Pool</button>
</div>

<!-- ç®¡ç†æŒ‰é’® -->
<button class="admin-btn" onclick="adminAccess()">âš™ï¸</button>

<script>
// Google SheetsåŒæ­¥åœ°å€
const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbzWBIcHXqsSYG82SJ9EmRs8eNAE53CKvP81YH-mmHHHNuLDrAW9dKE3WgapNxmeSE5kcQ/exec";

// åŸå§‹å¥–æ± 
const originalPrizes = {
  "RM100": 100,
  "RM1499": 1
};

let prizes = {...originalPrizes}; // å½“å‰å¥–æ± 
let results = [];
let totalDraws = 0;

function sendToGoogleSheets(zmy, email, prize, timestamp) {
  fetch(GOOGLE_SHEET_URL, {
    method: "POST",
    body: JSON.stringify({ timestamp: timestamp, zmycode: zmy, email: email, result: prize })
  }).then(res => console.log("åŒæ­¥æˆåŠŸ")).catch(err => console.error("åŒæ­¥å¤±è´¥", err));
}

document.getElementById('startButton').addEventListener('click', () => {
  const zmy = document.getElementById('zmycode').value.trim();
  const email = document.getElementById('email').value.trim();
  const drawtimes = parseInt(document.getElementById('drawtimes').value);

  if (!zmy || !email || isNaN(drawtimes) || drawtimes <= 0) {
    alert("è¯·å®Œæ•´å¡«å†™ä¿¡æ¯ / Please complete all information");
    return;
  }

  document.getElementById('startButton').disabled = true;
  const box = document.getElementById('blindbox');
  box.classList.add('shake');

  setTimeout(() => {
    box.classList.remove('shake');
    for (let i = 0; i < drawtimes; i++) {
      totalDraws++;
      const prize = pickPrize();
      const now = new Date();
      const timestamp = now.getFullYear() + "-" + 
                        ("0" + (now.getMonth()+1)).slice(-2) + "-" + 
                        ("0" + now.getDate()).slice(-2) + " " +
                        ("0" + now.getHours()).slice(-2) + ":" +
                        ("0" + now.getMinutes()).slice(-2) + ":" +
                        ("0" + now.getSeconds()).slice(-2) + " GMT+8";
      const message = `ğŸ‰ ${zmy} æŠ½ä¸­äº† ${prize}ï¼Congratulations! You won ${prize}! (${timestamp})`;
      results.push({timestamp, zmy, email, prize});
      document.getElementById('result').innerHTML += `<p>${message}</p>`;
      sendToGoogleSheets(zmy, email, prize, timestamp);
    }
    document.getElementById('startButton').disabled = false;
  }, 1000);
});

function pickPrize() {
  if (totalDraws > 20 && prizes["RM1499"] > 0) {
    prizes["RM1499"]--;
    return "RM1499";
  } else if (prizes["RM100"] > 0) {
    prizes["RM100"]--;
    return "RM100";
  } else {
    return "è°¢è°¢å‚ä¸ / Thank you";
  }
}

// ç®¡ç†å‘˜å…¥å£
function adminAccess() {
  const pwd = prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç  / Enter Admin Password");
  if (pwd === "888888") {
    document.getElementById('adminZone').style.display = 'block';
  }
}

// é‡ç½®å¥–æ± 
function resetPool() {
  if (confirm("ç¡®è®¤è¦é‡ç½®å¥–æ± å—ï¼Ÿ/ Confirm reset prize pool?")) {
    prizes = {...originalPrizes};
    totalDraws = 0;
    results = [];
    document.getElementById('result').innerHTML = "";
    alert("å¥–æ± å·²é‡ç½®æˆåŠŸï¼/ Prize pool has been reset!");
  }
}
</script>

</body>
</html>
